{% extends "base.html" %}

{% block main_content %}
<div class="dish-page">
    <h1>Dish Details</h1>
    
    {% if dish %}
    <div class="dish-info">
        <h2>{% if dish.name %}{{ dish.name }}{% else %}Dish #{{ dish.did }}{% endif %}</h2>
        <p><strong>Description:</strong> {{ dish.description or 'No description available' }}</p>
    </div>

    <hr>

    <h2>Photos of this dish</h2>
    {% if dish_pics %}
        <div class="dish-photos">
            {% for pic in dish_pics %}
                <div class="dish-photo-item">
                    <img src="{{ url_for('static', filename='uploads/' ~ pic[1]) }}"
                        alt="Dish photo"
                        style="max-width: 200px; margin: 5px;">

                    <form method="POST"
                        action="{{ url_for('delete_dish_pic', did=dish.did, pid=pic[0]) }}"
                        style="display:inline">
                        <button type="submit">Delete</button>
                    </form>
                </div>
            {% endfor %}
        </div>
    {% else %}
        <p>No photos yet. Be the first to upload one!</p>
    {% endif %}
    
    <hr>
    
    <h2>Upload a Picture</h2>
    
    <!-- Picture Upload Form -->
    <div class="picture-form">
        <form method="POST" 
              action="{{ url_for('get_dish', did=dish.did) }}"
              enctype="multipart/form-data">
            <div class="form-group">
                <label for="picture">Upload a picture:</label>
                <input type="file" id="picture" name="picture" required>
            </div>
            
            <button type="submit">Upload Picture</button>
        </form>
    </div>
    
    <hr>
    
    <h2>Add a Comment</h2>
    
    <!-- Comment Form -->
    <div class="comment-form">
        <form method="POST" 
              action="{{ url_for('get_dish', did=dish.did) }}"
              enctype="multipart/form-data">
            <div class="form-group">
                <label for="type">Rating:</label>
                <select id="type" name="type" required>
                    <option value="yum">Yum ðŸ˜‹</option>
                    <option value="yuck">Yuck ðŸ¤®</option>
                </select>
            </div>
            
            <div class="form-group">
                <label for="comment">Your Comment:</label>
                <textarea id="comment" name="comment" rows="4" 
                          placeholder="Share your thoughts about this dish..." required></textarea>
            </div>
            
            <button type="submit">Submit Comment</button>
        </form>
    </div>
    
    <hr>
    
    <!-- Existing Comments -->
    <div class="comments-section">
        <h3>All Comments ({{ comments|length }})</h3>
        
        {% if comments %}
            {% for comment in comments %}
            <div class="comment-item">
                <div class="comment-header">
                    <span class="comment-type {{ comment[2] }}">
                        {% if comment[2] == 'yum' %}
                            ðŸ˜‹ Yum
                        {% else %}
                            ðŸ¤® Yuck
                        {% endif %}
                    </span>
                    <span class="comment-author">
                        {% if comment[5] %}
                            by {{ comment[5] }}
                        {% else %}
                            by User #{{ comment[1] }}
                        {% endif %}
                    </span>
                    <form method="POST"
                        action="{{ url_for('delete_comment', did=dish.did, commentid=comment[0]) }}"
                        style="display:inline; margin-left: 10px;">
                        <button type="submit">Delete</button>
                    </form>
                </div>
                <div class="comment-text">
                    {{ comment[3] }}
                </div>
                {% if comment[4] %}
                <div class="comment-image">
                    <img src="{{ url_for('static', filename='uploads/' ~ comment[4]) }}"
                         alt="Dish picture"
                         style="max-width: 200px;">
                </div>
                {% endif %}
            </div>
            {% endfor %}
        {% else %}
            <p>No comments yet. Be the first to comment!</p>
        {% endif %}
    </div>
    
    {% else %}
    <p>Dish not found.</p>
    {% endif %}
</div>

<style>
.comment-text {
    padding-left: 20px;
    margin-top: 10px;
    line-height: 1.6;
}
</style>
{% endblock %}